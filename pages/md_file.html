<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Clip MD Generator</title>

<style>
:root{
  --border:#d9d9d9;
  --danger-bg:#fff0f0;
  --danger-border:#e08c8c;
}

body{
  margin:0;
  font-family: Georgia, "Times New Roman", serif;
  font-size:18px;
  background:#fff;
}

.wrap{
  max-width:980px;
  margin:auto;
  padding:20px;
}

.row{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  align-items:flex-start; /* FIX */
  margin-bottom:14px;
}

.field{
  flex:1;
  min-width:220px;
  display:flex;
  flex-direction:column;
  gap:6px;
}

label{
  font-size:14px;
  color:#666;
}

input, textarea{
  font-family:inherit;
  font-size:18px;
  padding:10px 12px;
  border:1px solid var(--border);
  border-radius:10px;
}

input.invalid{
  background:var(--danger-bg);
  border-color:var(--danger-border);
}

.edit-box{
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
}

.editor{
  min-height:100px;
  outline:none;
}

.checks{
  display:flex;
  gap:14px;
  flex-wrap:wrap;
  font-size:16px;
}

button{
  font-size:18px;
  padding:12px 18px;
  border-radius:14px;
  border:1px solid #111;
  background:#111;
  color:#fff;
  cursor:pointer;
}

.error{
  display:none;
  margin-top:10px;
  padding:10px;
  border:1px solid var(--danger-border);
  background:var(--danger-bg);
  border-radius:10px;
}
</style>
</head>

<body>
<div class="wrap">

<div class="row">
  <div class="field">
    <label>Title</label>
    <input id="title" type="text">
  </div>

  <div class="field">
    <label>Publisher</label>
    <input id="publisher" type="text">
    <label><input type="checkbox" id="publisherItalic"> Italicize publisher</label>
  </div>
</div>

<div class="row">
  <div class="field">
    <label>Publication URL</label>
    <input id="publisherUrl" type="url">
  </div>

  <div class="field">
    <label>Date</label>
    <input id="datePick" type="date">
  </div>

  <div class="field">
    <label>Byline</label>
    <input id="byline" type="text" value="Michal Ruprecht">
  </div>
</div>

<div class="checks">
  <label><input type="checkbox" id="hasPdf" checked> PDF available</label>
</div>

<div class="row">
  <div class="field">
    <label>Caption (bold + italics only)</label>
    <div class="edit-box">
      <div id="captionEditor" class="editor" contenteditable></div>
    </div>
  </div>
</div>

<div class="row">
  <div class="field">
    <label>Story text</label>
    <div class="edit-box">
      <div id="storyEditor" class="editor" contenteditable></div>
    </div>
  </div>
</div>

<button id="downloadBtn">Download MD</button>
<div id="err" class="error"></div>

</div>

<script>
function sanitize(html){
  const allowed = ["B","STRONG","I","EM","A","P"];
  const tmp = document.createElement("div");
  tmp.innerHTML = html;

  tmp.querySelectorAll("*").forEach(el=>{
    if(!allowed.includes(el.tagName)){
      el.replaceWith(...el.childNodes);
    }else{
      [...el.attributes].forEach(a=>{
        if(el.tagName === "A" && a.name === "href") return;
        el.removeAttribute(a.name);
      });
    }
  });

  return tmp.innerHTML
    .replace(/<p>\s*<\/p>/g,"")
    .trim();
}

function getClean(editor){
  const html = editor.innerHTML || "";
  return sanitize(html);
}

document.querySelectorAll(".editor").forEach(ed=>{
  ed.addEventListener("paste", e=>{
    e.preventDefault();
    const text = (e.clipboardData || window.clipboardData).getData("text/plain");
    document.execCommand("insertText", false, text);
  });
});

document.getElementById("downloadBtn").onclick = ()=>{
  const t = title.value.trim();
  const p = publisher.value.trim();
  const u = publisherUrl.value.trim();

  if(!t || !p || !u){
    err.style.display="block";
    err.textContent="Please fill out Title, Publisher, and Publication URL before downloading.";
    return;
  }

  const caption = getClean(captionEditor);
  const story = getClean(storyEditor);

  console.log("caption_html:", caption);
  console.log("story_html:", story);
};
</script>
</body>
</html>
